<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>üì¶ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - Fuji Mobile Shop</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>

<body>
    <div class="container pt-3">

        <!-- Header -->
        <header class="text-center mb-4">
            <img src="https://cdn.vectorstock.com/i/1000v/99/91/smartphone-repair-services-gear-up-for-mobile-vector-55249991.avif"
                alt="logo" class="logo mb-2" style="width:100px; height:auto; object-fit:contain;">
            <h4 class="mb-0">Fuji Mobile Shop</h4>
            <small>‡ªÄ‡∫ö‡∫µ‡ªÇ‡∫ó‡∫•‡∫∞‡∫™‡∫±‡∫ö: 02091940568 | Whatsapp: 02098614336</small>
        </header>

        <!-- Navigation -->
        <div class="text-center mb-3">
            <a href="index.html" class="btn btn-secondary btn-sm">‚¨Ö ‡∫Å‡∫±‡∫ö‡ªÑ‡∫õ‡∫´‡∫ô‡ªâ‡∫≤‡∫ó‡∫≥‡∫≠‡∫¥‡∫î</a>
            <a href="print.html" class="btn btn-info btn-sm ml-2">üßæ ‡∫û‡∫¥‡∫°‡ªÉ‡∫ö‡∫Æ‡∫±‡∫ö‡ªÄ‡∫á‡∫¥‡∫ô</a>
            <a href="summary.html" class="btn btn-info btn-sm ml-2">üíπ ‡∫™‡∫∞‡∫´‡∫•‡∫π‡∫ö‡∫ç‡∫≠‡∫î‡∫Ç‡∫≤‡∫ç</a>
            <a href="daily-report.html" class="btn btn-info btn-sm ml-2">üìÜ ‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫ç‡∫≠‡∫î‡∫Ç‡∫≤‡∫ç‡∫•‡∫≤‡∫ç‡∫ß‡∫±‡∫ô</a>
        </div>

        <!-- Summary Section -->
        <div class="text-center my-4">
            <h5>‡∫™‡∫∞‡∫´‡∫•‡∫π‡∫ö‡∫ç‡∫≠‡∫î‡∫Ç‡∫≤‡∫ç‡∫û‡∫≤‡∫ç‡ªÉ‡∫ô‡∫´‡∫ô‡∫∑‡ªà‡∫á‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô</h5>
        </div>

        <div class="table-responsive mb-5">
            <table class="table table-bordered table-sm text-center">
                <thead class="thead-dark">
                    <tr>
                        <th>‡ªÄ‡∫õ‡∫ª‡ªâ‡∫≤‡∫´‡∫°‡∫≤‡∫ç‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô‡∫ô‡∫µ‡ªâ</th>
                        <th>‡∫ç‡∫≠‡∫î‡∫Ç‡∫≤‡∫ç‡ªÄ‡∫î‡∫∑‡∫≠‡∫ô‡∫ô‡∫µ‡ªâ</th>
                        <th>‡∫Å‡∫≥‡ªÑ‡∫•/‡∫Ç‡∫≤‡∫î‡∫ó‡∫∑‡∫ô</th>
                        <th>‡∫à‡∫±‡∫î‡∫Å‡∫≤‡∫ô</th>
                    </tr>
                </thead>
                <tbody id="summaryTableBody"></tbody>
            </table>

            <div class="form-row mb-3">
                <div class="col-md-3">
                    <input type="number" id="monthlyTarget" class="form-control" placeholder="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢" step="0.01">
                </div>
                <div class="col-md-3">
                    <input type="number" id="monthlySales" class="form-control" placeholder="‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢" step="0.01">
                </div>
                <div class="col-md-3">
                    <button id="addSummary" class="btn btn-success btn-block">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏£‡∏∏‡∏õ</button>
                </div>
            </div>
        </div>

        <!-- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞ Section -->
        <div class="text-center my-4">
            <h5>üìã ‡∫ö‡∫±‡∫ô‡∫ó‡∫∂‡∫Å‡∫•‡∫≤‡∫ç‡∫á‡∫≤‡∫ô‡∫•‡∫π‡∫Å‡∫Ñ‡ªâ‡∫≤‡∫Ñ‡ªâ‡∫≤‡∫á‡∫ä‡∫≥‡∫•‡∫∞</h5>
        </div>

        <div class="table-responsive mb-4">
            <table class="table table-bordered table-sm text-center">
                <thead class="thead-dark">
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡πà‡∏≠‡∏°</th>
                        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡∏ï‡∏¥‡∏î‡∏´‡∏ô‡∏µ‡πâ/‡∏ú‡πà‡∏≠‡∏ô)</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="debtTableBody"></tbody>
            </table>

            <div class="form-row mb-3">
                <div class="col-md-2">
                    <input type="text" id="debtDate" class="form-control" placeholder="‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ">
                </div>
                <div class="col-md-2">
                    <input type="text" id="debtCustomer" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤">
                </div>
                <div class="col-md-2">
                    <input type="text" id="debtItem" class="form-control" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°">
                </div>
                <div class="col-md-2">
                    <input type="number" id="debtBuy" class="form-control" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠" step="0.01">
                </div>
                <div class="col-md-2">
                    <input type="number" id="debtRepair" class="form-control" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡πà‡∏≠‡∏°" step="0.01">
                </div>
                <div class="col-md-2">
                    <input type="text" id="debtStatus" class="form-control" placeholder="‡∏ï‡∏¥‡∏î‡∏´‡∏ô‡∏µ‡πâ/‡∏ú‡πà‡∏≠‡∏ô">
                </div>
            </div>
            <div class="text-center mb-5">
                <button id="addDebt" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
            </div>
        </div>

        <!-- üì¶ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ Section -->
        <div class="text-center my-4">
            <h5>üì¶ ‡∫•‡∫≤‡∫ç‡∫Å‡∫≤‡∫ô‡∫Ç‡∫≤‡∫ç‡ªÄ‡∫Ñ‡∫∑‡ªà‡∫≠‡∫á</h5>
        </div>

        <!-- Add Form -->
        <form id="addProductForm" class="mb-3">
            <div class="form-row">
                <div class="form-group col-md-2">
                    <input type="text" id="barcode" class="form-control" placeholder="‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ">
                </div>
                <div class="form-group col-md-3">
                    <input type="text" id="name" class="form-control" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                </div>
                <div class="form-group col-md-2">
                    <input type="number" id="qty" class="form-control" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="0">
                </div>
                <div class="form-group col-md-2">
                    <input type="number" id="buy" class="form-control" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠/‡∏ä‡∏¥‡πâ‡∏ô" step="0.01" min="0">
                </div>
                <div class="form-group col-md-2">
                    <input type="number" id="sell" class="form-control" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢/‡∏ä‡∏¥‡πâ‡∏ô" step="0.01" min="0">
                </div>
                <div class="form-group col-md-1">
                    <button type="submit" class="btn btn-primary btn-block">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
            </div>
        </form>

        <div class="table-responsive mb-3">
            <table class="table table-bordered table-hover table-sm">
                <thead class="thead-dark text-center">
                    <tr>
                        <th>‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ</th>
                        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠/‡∏≠‡∏±‡∏ô</th>
                        <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢/‡∏≠‡∏±‡∏ô</th>
                        <th>‡∏Å‡∏≥‡πÑ‡∏£/‡∏≠‡∏±‡∏ô</th>
                        <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="stockTableBody" class="text-center"></tbody>
                <tfoot class="font-weight-bold text-center bg-light">
                    <tr>
                        <td colspan="3">‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</td>
                        <td id="totalBuy">0.00</td>
                        <td id="totalSell">0.00</td>
                        <td id="totalProfit">0.00</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <div class="text-right mb-4">
            <button id="downloadExcel" class="btn btn-success">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel</button>
        </div>

        <footer class="mt-4 small text-center">
            Fuji Mobile Shop | ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: 02091940568 | Whatsapp: 02098614336<br>
            ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°: Venkhamxiong Yonglue
        </footer>
    </div>

    <script>
        let stock = JSON.parse(localStorage.getItem('stock')) || [];
        let summary = JSON.parse(localStorage.getItem('summary')) || [];
        let debts = JSON.parse(localStorage.getItem('debts')) || [];

        const tableBody = document.getElementById('stockTableBody');
        const summaryTableBody = document.getElementById('summaryTableBody');
        const debtTableBody = document.getElementById('debtTableBody');

        function saveStock() { localStorage.setItem('stock', JSON.stringify(stock)); }
        function saveSummary() { localStorage.setItem('summary', JSON.stringify(summary)); }
        function saveDebts() { localStorage.setItem('debts', JSON.stringify(debts)); }

        // ----- STOCK -----
        function renderStock() {
            tableBody.innerHTML = '';
            let totalBuy = 0, totalSell = 0, totalProfit = 0;
            stock.forEach((item, index) => {
                const profit = item.sell - item.buy;
                totalBuy += item.buy * item.qty;
                totalSell += item.sell * item.qty;
                totalProfit += profit * item.qty;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.barcode}</td>
                    <td>${item.name}</td>
                    <td>${item.qty}</td>
                    <td>${item.buy.toFixed(2)}</td>
                    <td>${item.sell.toFixed(2)}</td>
                    <td>${profit.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn btn-sm btn-danger delete">‡∏•‡∏ö</button>
                    </td>`;
                row.querySelector('.delete').addEventListener('click', () => {
                    if (confirm('‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?')) { stock.splice(index, 1); saveStock(); renderStock(); }
                });
                row.querySelector('.edit').addEventListener('click', () => {
                    const newName = prompt('‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà', item.name);
                    if (newName) { item.name = newName; saveStock(); renderStock(); }
                });
                tableBody.appendChild(row);
            });
            document.getElementById('totalBuy').textContent = totalBuy.toFixed(2);
            document.getElementById('totalSell').textContent = totalSell.toFixed(2);
            document.getElementById('totalProfit').textContent = totalProfit.toFixed(2);
        }

        // ----- SUMMARY -----
        function renderSummary() {
            summaryTableBody.innerHTML = '';
            summary.forEach((item, index) => {
                const profit = item.sales - item.target;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.target.toFixed(2)}</td>
                    <td>${item.sales.toFixed(2)}</td>
                    <td>${profit.toFixed(2)}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-summary">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn btn-sm btn-danger delete-summary">‡∏•‡∏ö</button>
                    </td>`;
                row.querySelector('.delete-summary').addEventListener('click', () => {
                    if (confirm('‡∏•‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏ô‡∏µ‡πâ?')) { summary.splice(index, 1); saveSummary(); renderSummary(); }
                });
                summaryTableBody.appendChild(row);
            });
        }

        document.getElementById('addSummary').addEventListener('click', () => {
            const target = parseFloat(document.getElementById('monthlyTarget').value) || 0;
            const sales = parseFloat(document.getElementById('monthlySales').value) || 0;
            summary.push({ target, sales });
            saveSummary(); renderSummary();
            document.getElementById('monthlyTarget').value = '';
            document.getElementById('monthlySales').value = '';
        });

        // ----- DEBT -----
        function renderDebts() {
            debtTableBody.innerHTML = '';
            debts.forEach((d, i) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${d.date}</td>
                    <td>${d.customer}</td>
                    <td>${d.item}</td>
                    <td>${d.buy}</td>
                    <td>${d.repair}</td>
                    <td>${d.status}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-debt">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn btn-sm btn-danger delete-debt">‡∏•‡∏ö</button>
                    </td>`;
                row.querySelector('.delete-debt').addEventListener('click', () => {
                    if (confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?')) { debts.splice(i, 1); saveDebts(); renderDebts(); }
                });
                row.querySelector('.edit-debt').addEventListener('click', () => {
                    const newStatus = prompt('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà', d.status);
                    if (newStatus !== null) { d.status = newStatus; saveDebts(); renderDebts(); }
                });
                debtTableBody.appendChild(row);
            });
        }

        document.getElementById('addDebt').addEventListener('click', () => {
            const date = document.getElementById('debtDate').value.trim();
            const customer = document.getElementById('debtCustomer').value.trim();
            const item = document.getElementById('debtItem').value.trim();
            const buy = parseFloat(document.getElementById('debtBuy').value) || 0;
            const repair = parseFloat(document.getElementById('debtRepair').value) || 0;
            const status = document.getElementById('debtStatus').value.trim();

            if (!date || !customer || !item) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            debts.push({ date, customer, item, buy, repair, status });
            saveDebts(); renderDebts();
            document.getElementById('debtDate').value =
                document.getElementById('debtCustomer').value =
                document.getElementById('debtItem').value =
                document.getElementById('debtBuy').value =
                document.getElementById('debtRepair').value =
                document.getElementById('debtStatus').value = '';
        });

        // ----- ADD STOCK -----
        document.getElementById('addProductForm').addEventListener('submit', e => {
            e.preventDefault();
            const barcode = document.getElementById('barcode').value.trim();
            const name = document.getElementById('name').value.trim();
            const qty = parseInt(document.getElementById('qty').value) || 0;
            const buy = parseFloat(document.getElementById('buy').value) || 0;
            const sell = parseFloat(document.getElementById('sell').value) || 0;
            if (!barcode || !name) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');

            stock.push({ barcode, name, qty, buy, sell });
            saveStock(); renderStock();

            // ‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
            const total = sell * qty;
            const profit = (sell - buy) * qty;
            saveSaleRecord(barcode, "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô", name, total, profit);

            document.getElementById('barcode').value = '';
            document.getElementById('name').value = '';
            document.getElementById('qty').value = '';
            document.getElementById('buy').value = '';
            document.getElementById('sell').value = '';
        });

        // ----- SALES RECORDS (‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô) -----
        function saveSaleRecord(date, customer, detail, total, profit) {
            let sales = JSON.parse(localStorage.getItem("salesRecords")) || [];
            sales.push({
                date: date,
                customer: customer || "‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô",
                detail: detail,
                total: total,
                profit: profit
            });
            localStorage.setItem("salesRecords", JSON.stringify(sales));
        }

        // ----- DOWNLOAD EXCEL -----
        document.getElementById('downloadExcel').addEventListener('click', () => {
            const wb = XLSX.utils.book_new();

            const stockData = [['‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ', '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ç‡∏≤‡∏¢']];
            stock.forEach(s => stockData.push([s.barcode, s.name, s.qty, s.buy, s.sell]));
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(stockData), 'Stock');

            const summaryData = [['‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢', '‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢', '‡∏Å‡∏≥‡πÑ‡∏£']];
            summary.forEach(s => summaryData.push([s.target, s.sales, s.sales - s.target]));
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(summaryData), 'Summary');

            const debtData = [['‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ', '‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡∏∑‡πâ‡∏≠', '‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ã‡πà‡∏≠‡∏°', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞']];
            debts.forEach(d => debtData.push([d.date, d.customer, d.item, d.buy, d.repair, d.status]));
            XLSX.utils.book_append_sheet(wb, XLSX.utils.aoa_to_sheet(debtData), 'Debts');

            XLSX.writeFile(wb, 'FujiMobile_Data.xlsx');
        });

        renderStock();
        renderSummary();
        renderDebts();
    </script>
</body>

</html>